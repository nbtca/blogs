<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Linux笔记 - 信号 | nbtca&#39;s blog</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/blogs/img/favicon.ico">
    <meta name="description" content="有关linux信号的一系列笔记。">
    <meta name="keywords" content="前端博客,个人技术博客,前端,前端开发,前端框架,web前端,前端面试题,技术文档,学习,面试,JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,github,markdown">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/blogs/assets/css/0.styles.2b610ef7.css" as="style"><link rel="preload" href="/blogs/assets/js/app.4e3e2af5.js" as="script"><link rel="preload" href="/blogs/assets/js/3.cae9d0dd.js" as="script"><link rel="preload" href="/blogs/assets/js/2.3e01c173.js" as="script"><link rel="preload" href="/blogs/assets/js/19.9ff3ccd4.js" as="script"><link rel="prefetch" href="/blogs/assets/js/1.9c67557b.js"><link rel="prefetch" href="/blogs/assets/js/10.b42142bb.js"><link rel="prefetch" href="/blogs/assets/js/11.d6ed255f.js"><link rel="prefetch" href="/blogs/assets/js/12.3ae3203e.js"><link rel="prefetch" href="/blogs/assets/js/13.44e7785f.js"><link rel="prefetch" href="/blogs/assets/js/14.978aee7a.js"><link rel="prefetch" href="/blogs/assets/js/15.d644ab42.js"><link rel="prefetch" href="/blogs/assets/js/16.804f5bb0.js"><link rel="prefetch" href="/blogs/assets/js/17.68c0f214.js"><link rel="prefetch" href="/blogs/assets/js/18.83c123fb.js"><link rel="prefetch" href="/blogs/assets/js/20.f779867f.js"><link rel="prefetch" href="/blogs/assets/js/21.8dd07746.js"><link rel="prefetch" href="/blogs/assets/js/22.56ff0b7d.js"><link rel="prefetch" href="/blogs/assets/js/23.a6107fe7.js"><link rel="prefetch" href="/blogs/assets/js/24.0d3d3fd2.js"><link rel="prefetch" href="/blogs/assets/js/25.ce296d9d.js"><link rel="prefetch" href="/blogs/assets/js/26.7d153fbe.js"><link rel="prefetch" href="/blogs/assets/js/27.60015939.js"><link rel="prefetch" href="/blogs/assets/js/28.7a31a0fb.js"><link rel="prefetch" href="/blogs/assets/js/29.f74e4bac.js"><link rel="prefetch" href="/blogs/assets/js/30.ec518614.js"><link rel="prefetch" href="/blogs/assets/js/31.97ee026f.js"><link rel="prefetch" href="/blogs/assets/js/32.9361cdc0.js"><link rel="prefetch" href="/blogs/assets/js/33.a1c24dcf.js"><link rel="prefetch" href="/blogs/assets/js/34.0a78da7c.js"><link rel="prefetch" href="/blogs/assets/js/35.19ffa2bd.js"><link rel="prefetch" href="/blogs/assets/js/36.96cb54b5.js"><link rel="prefetch" href="/blogs/assets/js/37.8d5f7cae.js"><link rel="prefetch" href="/blogs/assets/js/38.c9aeb214.js"><link rel="prefetch" href="/blogs/assets/js/39.98039708.js"><link rel="prefetch" href="/blogs/assets/js/4.ff1945ce.js"><link rel="prefetch" href="/blogs/assets/js/40.1c46d02f.js"><link rel="prefetch" href="/blogs/assets/js/41.c476b400.js"><link rel="prefetch" href="/blogs/assets/js/42.f1f9bb5b.js"><link rel="prefetch" href="/blogs/assets/js/43.1f92c216.js"><link rel="prefetch" href="/blogs/assets/js/44.c9238af6.js"><link rel="prefetch" href="/blogs/assets/js/45.733da100.js"><link rel="prefetch" href="/blogs/assets/js/46.35cb9742.js"><link rel="prefetch" href="/blogs/assets/js/47.c4c8cf62.js"><link rel="prefetch" href="/blogs/assets/js/48.b16d88fc.js"><link rel="prefetch" href="/blogs/assets/js/49.656a10f9.js"><link rel="prefetch" href="/blogs/assets/js/5.e1b3cf5e.js"><link rel="prefetch" href="/blogs/assets/js/50.4c8cf2a5.js"><link rel="prefetch" href="/blogs/assets/js/51.f70b3259.js"><link rel="prefetch" href="/blogs/assets/js/52.bb5f19b2.js"><link rel="prefetch" href="/blogs/assets/js/53.706dc212.js"><link rel="prefetch" href="/blogs/assets/js/54.50a3bdf4.js"><link rel="prefetch" href="/blogs/assets/js/55.83ce3926.js"><link rel="prefetch" href="/blogs/assets/js/56.a19b841f.js"><link rel="prefetch" href="/blogs/assets/js/57.b4e57742.js"><link rel="prefetch" href="/blogs/assets/js/6.ebe718a8.js"><link rel="prefetch" href="/blogs/assets/js/9.2d6a470b.js"><link rel="prefetch" href="/blogs/assets/js/vendors~docsearch.9a9ec59f.js">
    <link rel="stylesheet" href="/blogs/assets/css/0.styles.2b610ef7.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blogs/" class="home-link router-link-active"><img src="/blogs/img/logo.png" alt="nbtca's blog" class="logo"> <span class="site-name can-hide">nbtca's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blogs/" class="nav-link">首页</a></div><div class="nav-item"><a href="/blogs/technology/" class="nav-link">技术</a></div><div class="nav-item"><a href="/blogs/more/" class="nav-link">更多</a></div><div class="nav-item"><a href="/blogs/about/" class="nav-link">关于</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/blogs/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blogs/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/blogs/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/blogs/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/nbtca" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://nbtca-1310707740.cos.ap-shanghai.myqcloud.com/logo.jpg"> <div class="blogger-info"><h3>nbtca</h3> <span>计协</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/blogs/" class="nav-link">首页</a></div><div class="nav-item"><a href="/blogs/technology/" class="nav-link">技术</a></div><div class="nav-item"><a href="/blogs/more/" class="nav-link">更多</a></div><div class="nav-item"><a href="/blogs/about/" class="nav-link">关于</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/blogs/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blogs/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/blogs/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/blogs/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/nbtca" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>C语言</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>GO语言</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Linux</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blogs/pages/324bec/" class="sidebar-link">Linux笔记 - 进程</a></li><li><a href="/blogs/pages/82d273/" class="sidebar-link">Linux笔记 - 文件I/O</a></li><li><a href="/blogs/pages/aff776/" aria-current="page" class="active sidebar-link">Linux笔记 - 信号</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/blogs/pages/aff776/#linux-信号" class="sidebar-link">Linux 信号</a></li><li class="sidebar-sub-header level2"><a href="/blogs/pages/aff776/#linux信号-续" class="sidebar-link">Linux信号(续)</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Python</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/blogs/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/blogs/technology/#技术" data-v-06225672>技术</a></li><li data-v-06225672><a href="/blogs/technology/#Linux" data-v-06225672>Linux</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://www.cnblogs.com/N3ptune" target="_blank" title="作者" class="beLink" data-v-06225672>N3ptune</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2022-04-05</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">Linux笔记 - 信号<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h2 id="linux-信号"><a href="#linux-信号" class="header-anchor">#</a> <strong>Linux 信号</strong></h2> <p>信号本质上是整数，用户模式下用来模拟硬件中断。</p> <ul><li>什么是硬件中断？先理解为硬件引发的中断。</li> <li>什么是中断？简言之，就是让CPU停下当前干的事转而去处理新的情况。</li> <li>信号是谁产生的？可以由硬件、内核和进程产生。</li></ul> <p>例如在终端上用<code>Ctrl+C</code>，可以结束掉当前终端进程，本质上是发送SIGINT信号。</p> <p>如下是一个实例程序，该程序循环打印数字。运行起来，看看<code>Ctrl+C</code>能不能中止它：</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;signal.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdbool.h&gt;</span></span>

<span class="token keyword">void</span> <span class="token function">hand</span><span class="token punctuation">(</span><span class="token keyword">int</span> val<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;val: %d\n&quot;</span><span class="token punctuation">,</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Do you want to kill me? No way!\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">signal</span><span class="token punctuation">(</span>SIGINT<span class="token punctuation">,</span>hand<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>true<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;n:%d\n&quot;</span><span class="token punctuation">,</span>n<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>如下所示，现在使用Ctrl+C是没办法中断这个程序的：</p> <p><img src="/blogs/assets/img/signal-1.f1106095.png" alt="signal-1"></p> <p>这里可以用man命令查看一下signal函数的帮助文档：</p> <p><img src="/blogs/assets/img/signal-2.66b7a7f8.png" alt="signal-2"></p> <p>signal关联上了一个信号处理函数，来处理信号。</p> <p>现在修改这个代码，添加一行打印当前进程号，然后打开两个终端，一个终端运行上面的程序，一个终端尝试<code>kill</code>命令来发送信号：</p> <p><img src="/blogs/assets/img/signal-3.4eeb0826.png" alt="signal-3"></p> <p>kill 要指定参数：</p> <p><img src="/blogs/assets/img/signal-4.9aa5bdea.png" alt="signal-4"></p> <p>这是可行的，结果如上。</p> <p><strong>信号处理的过程</strong></p> <p>进程A在运行，内核、硬件或者其他进程发送信号给进程A。进程A接收到信号后，直接做信号本身规定的对应处理或者做事先注册好的信号处理。如上面signal函数就是注册信号处理，hand函数替换了本身默认的信号处理。当然信号是可以屏蔽的，不作任何处理。</p> <p>Linux有哪些信号类型：</p> <p><img src="/blogs/assets/img/signal-5.b2898d9a.png" alt="signal-5"></p> <p>Linux 信号有64个，分为不可靠信号(非实时，1-31，Unix提供)和可靠信号(32-64，后来扩充的)。又有系统自带的标准信号和用户自定义的信号。</p> <p>介绍几个命令或函数：</p> <ul><li>信号注册：<code>signal</code>、<code>sigaction;</code></li> <li>信号发送：<code>kill</code>命令、<code>kill</code>函数、<code>sigqueue;</code></li> <li>信号屏蔽：<code>sigprocmask</code>;</li> <li>信号集：<code>sigset_t</code>.</li></ul> <p>下面写一个发送信号的程序：</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;signal.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span><span class="token keyword">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">int</span> pid <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> sig <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;pid:%d  sig:%d\n&quot;</span><span class="token punctuation">,</span>pid<span class="token punctuation">,</span>sig<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">kill</span><span class="token punctuation">(</span>pid<span class="token punctuation">,</span>sig<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p><img src="data:image/png;base64,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" alt="signal-6"></p> <p><img src="/blogs/assets/img/signal-7.98dab60e.png" alt="signal-7"></p> <p>成功发送了信号。</p> <p><code>sigaction</code>函数有所不同，功能更多：</p> <p><img src="/blogs/assets/img/signal-8.8dbfa33a.png" alt="signal-8"></p> <p>这里用到了一个结构体：</p> <p><img src="/blogs/assets/img/signal-9.0ce6b0f3.png" alt="signal-9"></p> <p>结构体的第一个成员依然是原来的信号处理函数，第二个成员被称作高级信号处理函数，第三个成员用于信号屏蔽，剩下两个暂时还用不到。</p> <p>这个函数不仅可以发信号、做信号处理，还可以接收信号的同时接收数据</p> <p>下列代码使用了高级信号处理：</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;signal.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdbool.h&gt;</span></span>

<span class="token comment">// 基本信号处理函数</span>
<span class="token keyword">void</span> <span class="token function">hand</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;基本信号处理函数\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 高级信号处理函数</span>
<span class="token keyword">void</span> <span class="token function">handler</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">,</span><span class="token class-name">siginfo_t</span><span class="token operator">*</span> siginfo<span class="token punctuation">,</span><span class="token keyword">void</span><span class="token operator">*</span> arg<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;高级信号处理函数\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;n:%d msg:%d\n&quot;</span><span class="token punctuation">,</span>n<span class="token punctuation">,</span>siginfo<span class="token operator">-&gt;</span>si_int<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">struct</span> <span class="token class-name">sigaction</span> act <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token class-name">sigaction</span> old_act <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    act<span class="token punctuation">.</span>sa_handler <span class="token operator">=</span> hand<span class="token punctuation">;</span>
    act<span class="token punctuation">.</span>sa_sigaction <span class="token operator">=</span> handler<span class="token punctuation">;</span>
    act<span class="token punctuation">.</span>sa_flags <span class="token operator">=</span> SA_SIGINFO<span class="token punctuation">;</span>

    <span class="token comment">// 高级信号处理</span>
    <span class="token function">sigaction</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>act<span class="token punctuation">,</span><span class="token operator">&amp;</span>old_act<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;pid:%d\n&quot;</span><span class="token punctuation">,</span><span class="token function">getpid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>true<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;n:%d\n&quot;</span><span class="token punctuation">,</span>n<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><p>同时还要实现高级的信号发送，采用<code>sigqueue</code>：</p> <p><img src="/blogs/assets/img/signal-10.927b0962.png" alt="signal-10"></p> <p>这里有个重要的联合体，用来存储数据和信号一起发送：</p> <p><img src="/blogs/assets/img/signal-11.f1567c4b.png" alt="signal-11"></p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;signal.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span><span class="token keyword">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>  
    <span class="token keyword">int</span> pid <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> sig <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;pid:%d  sig:%d\n&quot;</span><span class="token punctuation">,</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">union</span> sigval u<span class="token punctuation">;</span>
    u<span class="token punctuation">.</span>sival_int <span class="token operator">=</span> <span class="token number">12345678</span><span class="token punctuation">;</span>
    <span class="token function">sigqueue</span><span class="token punctuation">(</span>pid<span class="token punctuation">,</span>sig<span class="token punctuation">,</span>u<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>运行结果如下：</p> <p><img src="/blogs/assets/img/signal-12.ea275c07.png" alt=""></p> <p><img src="/blogs/assets/img/signal-13.d5aaf523.png" alt="signal-13"></p> <p>可以看到程序接收到了信号和数据。</p> <p>也试试发送其他数据，联合体中还有一个指针类型的成员。</p> <h2 id="linux信号-续"><a href="#linux信号-续" class="header-anchor">#</a> Linux信号(续)</h2> <blockquote><p>参考网站: Github、《极客时间》</p></blockquote> <p>现在从底层角度来观赏Linux信号机制。</p> <p>首先看信号的具体作用：</p> <p><img src="/blogs/assets/img/signal-14.15b298a7.png" alt="signal-14"></p> <p><img src="/blogs/assets/img/signal-15.dd5ef641.png" alt="signal-15"></p> <p>如上文所提，处理信号有3种方式：执行默认操作，捕获信号和忽略信号</p> <p>设置信号处理有两种方式: signal和sigaction</p> <p>signal将一个动作和信号关联，sigaction也是将一个动作和信号关联，但这个动作用一个结构体表示了，处理信号将更加细致</p> <p>siganal不是系统调用，而是glibc封装的一个函数，实现如下：</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span>  <span class="token directive keyword">define</span> <span class="token macro-name">signal</span> <span class="token expression">__sysv_signal</span></span>
__sighandler_t
<span class="token function">__sysv_signal</span> <span class="token punctuation">(</span><span class="token keyword">int</span> sig<span class="token punctuation">,</span> __sighandler_t handler<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token keyword">struct</span> <span class="token class-name">sigaction</span> act<span class="token punctuation">,</span> oact<span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
  act<span class="token punctuation">.</span>sa_handler <span class="token operator">=</span> handler<span class="token punctuation">;</span>
  <span class="token function">__sigemptyset</span> <span class="token punctuation">(</span><span class="token operator">&amp;</span>act<span class="token punctuation">.</span>sa_mask<span class="token punctuation">)</span><span class="token punctuation">;</span>
  act<span class="token punctuation">.</span>sa_flags <span class="token operator">=</span> SA_ONESHOT <span class="token operator">|</span> SA_NOMASK <span class="token operator">|</span> SA_INTERRUPT<span class="token punctuation">;</span>
  act<span class="token punctuation">.</span>sa_flags <span class="token operator">&amp;=</span> <span class="token operator">~</span>SA_RESTART<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">__sigaction</span> <span class="token punctuation">(</span>sig<span class="token punctuation">,</span> <span class="token operator">&amp;</span>act<span class="token punctuation">,</span> <span class="token operator">&amp;</span>oact<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> SIG_ERR<span class="token punctuation">;</span>
  <span class="token keyword">return</span> oact<span class="token punctuation">.</span>sa_handler<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">weak_alias</span> <span class="token punctuation">(</span>__sysv_signal<span class="token punctuation">,</span> sysv_signal<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>这里可以看到 sa_flags 设置了一个SA_ONESHOT，这意味着信号处理函数只作用一次，用完一次后就返回默认行为</p> <p>同时设置了SA_NOMASK，通过 __sigemptyset，将 sa_mask 设置为空。这样的设置表示在这个信号处理函数执行过程中，如果再有其他信号，哪怕相同的信号到来的时候，这个信号处理函数会被中断。如果一个信号处理函数真的被其他信号中断，问题也不大，因为当处理完了其他的信号处理函数后，还会回来接着处理这个信号处理函数的，但是对于相同的信号就有点尴尬了。一般的思路应该是，当某一个信号的信号处理函数运行的时候，暂时屏蔽这个信号，屏蔽并不意味着信号一定丢失，而是暂存，这样能够做到信号处理函数对于相同的信号，处理完一个再处理下一个，这样信号处理函数的逻辑要简单得多。</p> <p>还有一个设置就是设置了 SA_INTERRUPT，清除了 SA_RESTART。信号的到来时间是不可预期的，有可能程序正在调用某个漫长的系统调用的时候，突然到来一个信号，中断了这个系统调用，去执行信号处理函数。那么执行完后信号处理函数，系统调用怎么办？</p> <p>时候有两种处理方法，一种就是 SA_INTERRUPT，也即系统调用被中断了，就不再重试这个系统调用了，而是直接返回一个 -EINTR 常量，告诉调用方，这个系统调用被信号中断了，调用方可以根据自己的逻辑，重新调用或者直接返回，这会使得代码非常复杂，在所有系统调用的返回值判断里面，都要特殊判断一下这个值。</p> <p>另外一种处理方法是 SA_RESTART。这个时候系统调用会被自动重新启动，不需要调用方自己写代码。当然也可能存在问题，例如从终端读入一个字符，这个时候用户在终端输入一个'a'字符，在处理'a'字符的时候被信号中断了，等信号处理完毕，再次读入一个字符的时候，如果用户不再输入，就停在那里了，需要用户再次输入同一个字符。</p> <p>可知signal函数是受到限制的，因此，建议使用 sigaction 函数，根据自己的需要定制参数。</p> <p>下面是glibc中的实现：</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token keyword">int</span>
<span class="token function">__sigaction</span> <span class="token punctuation">(</span><span class="token keyword">int</span> sig<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">sigaction</span> <span class="token operator">*</span>act<span class="token punctuation">,</span> <span class="token keyword">struct</span> <span class="token class-name">sigaction</span> <span class="token operator">*</span>oact<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
  <span class="token keyword">return</span> <span class="token function">__libc_sigaction</span> <span class="token punctuation">(</span>sig<span class="token punctuation">,</span> act<span class="token punctuation">,</span> oact<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token keyword">int</span>
<span class="token function">__libc_sigaction</span> <span class="token punctuation">(</span><span class="token keyword">int</span> sig<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">sigaction</span> <span class="token operator">*</span>act<span class="token punctuation">,</span> <span class="token keyword">struct</span> <span class="token class-name">sigaction</span> <span class="token operator">*</span>oact<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token keyword">int</span> result<span class="token punctuation">;</span>
  <span class="token keyword">struct</span> <span class="token class-name">kernel_sigaction</span> kact<span class="token punctuation">,</span> koact<span class="token punctuation">;</span>


  <span class="token keyword">if</span> <span class="token punctuation">(</span>act<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      kact<span class="token punctuation">.</span>k_sa_handler <span class="token operator">=</span> act<span class="token operator">-&gt;</span>sa_handler<span class="token punctuation">;</span>
      <span class="token function">memcpy</span> <span class="token punctuation">(</span><span class="token operator">&amp;</span>kact<span class="token punctuation">.</span>sa_mask<span class="token punctuation">,</span> <span class="token operator">&amp;</span>act<span class="token operator">-&gt;</span>sa_mask<span class="token punctuation">,</span> <span class="token keyword">sizeof</span> <span class="token punctuation">(</span><span class="token class-name">sigset_t</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      kact<span class="token punctuation">.</span>sa_flags <span class="token operator">=</span> act<span class="token operator">-&gt;</span>sa_flags <span class="token operator">|</span> SA_RESTORER<span class="token punctuation">;</span>


      kact<span class="token punctuation">.</span>sa_restorer <span class="token operator">=</span> <span class="token operator">&amp;</span>restore_rt<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


  result <span class="token operator">=</span> <span class="token function">INLINE_SYSCALL</span> <span class="token punctuation">(</span>rt_sigaction<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span>
                           sig<span class="token punctuation">,</span> act <span class="token operator">?</span> <span class="token operator">&amp;</span>kact <span class="token operator">:</span> <span class="token constant">NULL</span><span class="token punctuation">,</span>
                           oact <span class="token operator">?</span> <span class="token operator">&amp;</span>koact <span class="token operator">:</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> _NSIG <span class="token operator">/</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>oact <span class="token operator">&amp;&amp;</span> result <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      oact<span class="token operator">-&gt;</span>sa_handler <span class="token operator">=</span> koact<span class="token punctuation">.</span>k_sa_handler<span class="token punctuation">;</span>
      <span class="token function">memcpy</span> <span class="token punctuation">(</span><span class="token operator">&amp;</span>oact<span class="token operator">-&gt;</span>sa_mask<span class="token punctuation">,</span> <span class="token operator">&amp;</span>koact<span class="token punctuation">.</span>sa_mask<span class="token punctuation">,</span> <span class="token keyword">sizeof</span> <span class="token punctuation">(</span><span class="token class-name">sigset_t</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      oact<span class="token operator">-&gt;</span>sa_flags <span class="token operator">=</span> koact<span class="token punctuation">.</span>sa_flags<span class="token punctuation">;</span>
      oact<span class="token operator">-&gt;</span>sa_restorer <span class="token operator">=</span> koact<span class="token punctuation">.</span>sa_restorer<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><p>内核代码注释表明，系统调用 signal 是为了兼容过去，系统调用 sigaction 也是为了兼容过去，连参数都变成了 struct compat_old_sigaction，所以说，我们的库函数虽然调用的是 sigaction，到了系统调用层，调用的可不是系统调用 sigaction，而是系统调用 rt_sigaction。</p> <p>在 <code>rt_sigaction</code> 里面，将用户态的 struct sigaction 结构，拷贝为内核态的 <code>k_sigaction</code>，然后调用 <code>do_sigaction</code>。</p> <p><code>do_sigaction</code> 也很简单，进程内核的数据结构里，struct task_struct 里面有一个成员 sighand，里面有一个 action。</p> <p>这是一个数组，下标是信号，内容就是信号处理函数，<code>do_sigaction</code> 就是设置 sighand 里的信号处理函数。</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token keyword">int</span> <span class="token function">do_sigaction</span><span class="token punctuation">(</span><span class="token keyword">int</span> sig<span class="token punctuation">,</span> <span class="token keyword">struct</span> <span class="token class-name">k_sigaction</span> <span class="token operator">*</span>act<span class="token punctuation">,</span> <span class="token keyword">struct</span> <span class="token class-name">k_sigaction</span> <span class="token operator">*</span>oact<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token keyword">struct</span> <span class="token class-name">task_struct</span> <span class="token operator">*</span>p <span class="token operator">=</span> current<span class="token punctuation">,</span> <span class="token operator">*</span>t<span class="token punctuation">;</span>
  <span class="token keyword">struct</span> <span class="token class-name">k_sigaction</span> <span class="token operator">*</span>k<span class="token punctuation">;</span>
  <span class="token class-name">sigset_t</span> mask<span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
  k <span class="token operator">=</span> <span class="token operator">&amp;</span>p<span class="token operator">-&gt;</span>sighand<span class="token operator">-&gt;</span>action<span class="token punctuation">[</span>sig<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>


  <span class="token function">spin_lock_irq</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>p<span class="token operator">-&gt;</span>sighand<span class="token operator">-&gt;</span>siglock<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>oact<span class="token punctuation">)</span>
    <span class="token operator">*</span>oact <span class="token operator">=</span> <span class="token operator">*</span>k<span class="token punctuation">;</span>


  <span class="token keyword">if</span> <span class="token punctuation">(</span>act<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">sigdelsetmask</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>act<span class="token operator">-&gt;</span>sa<span class="token punctuation">.</span>sa_mask<span class="token punctuation">,</span>
            <span class="token function">sigmask</span><span class="token punctuation">(</span>SIGKILL<span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token function">sigmask</span><span class="token punctuation">(</span>SIGSTOP<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">*</span>k <span class="token operator">=</span> <span class="token operator">*</span>act<span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
  <span class="token punctuation">}</span>


  <span class="token function">spin_unlock_irq</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>p<span class="token operator">-&gt;</span>sighand<span class="token operator">-&gt;</span>siglock<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>总结：</p> <p><img src="/blogs/assets/img/7cb86c73b9e73893e6b0e0433d476928.0d825c8b.png" alt=""></p></div></div> <!----> <div class="page-edit"><div class="edit-link"><a href="https://github.com/nbtca/edit/master/docs/01.技术/03.Linux/08.Linux笔记-信号.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2024/03/29, 12:07:43</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/blogs/pages/82d273/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">Linux笔记 - 文件I/O</div></a> <a href="/blogs/pages/b8d343/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">Python爬虫实战-获取王者荣耀英雄大全</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/blogs/pages/82d273/" class="prev">Linux笔记 - 文件I/O</a></span> <span class="next"><a href="/blogs/pages/b8d343/">Python爬虫实战-获取王者荣耀英雄大全</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/blogs/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/blogs/pages/bd144d/"><div>
            Go语言极限入门
            <!----></div></a> <span class="date">04-19</span></dt></dl><dl><dd>02</dd> <dt><a href="/blogs/pages/b8d343/"><div>
            Python爬虫实战-获取王者荣耀英雄大全
            <!----></div></a> <span class="date">04-17</span></dt></dl><dl><dd>03</dd> <dt><a href="/blogs/pages/019940/"><div>
            Python爬虫实战 - 爬取TIOBE TOP20语言排行榜
            <!----></div></a> <span class="date">04-05</span></dt></dl> <dl><dd></dd> <dt><a href="/blogs/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="https://github.com/nbtca" title="GitHub" target="_blank" class="iconfont icon-github"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2023-2024
    <span></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/blogs/assets/js/app.4e3e2af5.js" defer></script><script src="/blogs/assets/js/3.cae9d0dd.js" defer></script><script src="/blogs/assets/js/2.3e01c173.js" defer></script><script src="/blogs/assets/js/19.9ff3ccd4.js" defer></script>
  </body>
</html>
